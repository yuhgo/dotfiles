---
description: "指定したプロジェクトパスのGitコミット履歴を取得し、ユーザー別にマークダウンファイルへ出力"
---

## 概要

指定したプロジェクトパスのGitコミット履歴を取得し、ユーザー別にマークダウンファイルへ出力

# Gitコミット履歴取得・出力コマンド

このコマンドは、指定されたプロジェクトのGitリポジトリから特定ユーザーのコミット履歴を取得し、日本時間に変換してマークダウンファイルに出力します。

## 実行フロー

1. **パラメータ確認**: プロジェクトパスとユーザー名の取得
2. **リポジトリ検証**: 指定パスがGitリポジトリかどうか確認
3. **コミット履歴取得**: git logコマンドでユーザーのコミット履歴を抽出
4. **日時変換**: コミット日時を日本時間（JST, UTC+9）に変換
5. **マークダウン生成**: 履歴をマークダウンファイルに整形して出力
6. **並び替え**: コミット日時の昇順（古い順）で並び替え

## パラメータ

### 必須パラメータ
- **プロジェクトパス**: コミット履歴を取得したいGitリポジトリのパス（絶対パスまたは相対パス）
- **ユーザー名**: コミット履歴を取得したいGitユーザー名（部分一致も可能）

### オプションパラメータ
- **出力ファイル名**: デフォルトは `git-history-[ユーザー名]-[日付].md`
- **期間指定**: 特定期間のコミットのみ取得（例: 最近1ヶ月、特定の日付範囲）
- **最大件数**: 取得するコミット数の上限（デフォルト: 制限なし）

## ユーザーへの質問

コマンドを実行する前に必ず、以下の順序でユーザーに確認します。

### 質問1: プロジェクトパス（必須）
```
Gitコミット履歴を取得したいプロジェクトのパスを入力してください。
（例: /Users/username/projects/my-app, ~/workspace/backend-api, ./）
```

### 質問2: ユーザー名（必須）
```
コミット履歴を取得したいGitユーザー名を入力してください。
（部分一致で検索されます。例: yamamotoyugo, yugo）
```

### 質問3: 期間指定（オプション）
```
取得する期間を指定しますか？
- 指定なし（全期間）
- 最近N日間（例: 30）
- 日付範囲（例: 2024-01-01〜2024-10-14）
```

### 質問4: 最大件数（オプション）
```
取得するコミット数の上限を指定しますか？
- 指定なし（制限なし）
- 件数指定（例: 50, 100）
```

### 質問5: 出力ファイル名（オプション）
```
出力ファイル名を指定しますか？
- デフォルト: git-history-[ユーザー名]-[日付].md
- カスタム: 任意のファイルパス
```

## Git Logコマンド仕様

```bash
cd [プロジェクトパス] && \
TZ=Asia/Tokyo git log \
  --author="[ユーザー名]" \
  --pretty=format:"%H|%an|%ae|%ad|%s|%b" \
  --date=iso \
  --numstat \
  --no-merges \
  --all
```

### フォーマット説明
- `%H`: コミットハッシュ（フル）
- `%an`: 作成者名
- `%ae`: 作成者メールアドレス
- `%ad`: 作成日時（ISO形式、日本時間に変換済み）
- `%s`: コミットメッセージ（件名）
- `%b`: コミットメッセージ（本文）
- `--numstat`: 各ファイルの追加・削除行数を表示
- `--no-merges`: マージコミットを除外

## 出力マークダウンフォーマット

```markdown
# Gitコミット履歴

**リポジトリ**: [プロジェクトパス]
**対象ユーザー**: [ユーザー名]
**取得日時**: [現在の日時（JST）]
**総コミット数**: [件数]

---

## コミット一覧（降順）

### 2024-10-14 13:45:23 JST
- **コミットハッシュ**: `abc123def456...`
- **作成者**: [ユーザー名] ([メールアドレス])
- **変更ファイル数**: 5ファイル（+120行, -45行）
- **メッセージ**: コミットメッセージの内容がここに表示されます
- **本文**:
  ```
  詳細なコミットメッセージの本文がここに表示されます。
  複数行にわたる説明や、変更の背景、理由などが含まれます。
  ```

### 2024-10-13 18:30:15 JST
- **コミットハッシュ**: `def456ghi789...`
- **作成者**: [ユーザー名] ([メールアドレス])
- **変更ファイル数**: 3ファイル（+80行, -20行）
- **メッセージ**: 別のコミットメッセージ
- **本文**:
  ```
  コミットの詳細情報
  ```

---

## 統計情報

- **最新コミット**: [日時]
- **最古コミット**: [日時]
- **期間**: [日数]日間
- **平均コミット頻度**: [頻度]コミット/日
```

## 実行例

### ユーザー入力例1: 基本的な使用
```
プロジェクトパス: /Users/yamamotoyugo/projects/my-app
ユーザー名: yamamotoyugo
```

### ユーザー入力例2: 期間指定
```
プロジェクトパス: ~/workspace/backend-api
ユーザー名: yugo
期間: 最近30日間
```

### ユーザー入力例3: 件数制限
```
プロジェクトパス: ./
ユーザー名: yamamoto
最大件数: 50
```

## システム応答例

```
📋 Gitコミット履歴を取得しています...

✅ リポジトリ確認完了: /Users/yamamotoyugo/projects/my-app
🔍 ユーザー "yamamotoyugo" のコミットを検索中...
📊 125件のコミットが見つかりました

📝 マークダウンファイルを生成中...
✅ 出力完了: git-history-yamamotoyugo-20241014.md

## 概要
- 総コミット数: 125件
- 期間: 2024-01-15 ～ 2024-10-14
- 最新コミット: 2024-10-14 13:45:23 JST
```

## エラーハンドリング

### リポジトリが見つからない場合
```
❌ エラー: 指定されたパスはGitリポジトリではありません
パス: /Users/yamamotoyugo/invalid-path

対処方法:
1. パスが正しいか確認してください
2. .gitディレクトリが存在するか確認してください
3. 絶対パスで指定してみてください
```

### ユーザーのコミットが見つからない場合
```
⚠️ 警告: ユーザー "unknown-user" のコミットが見つかりませんでした

対処方法:
1. ユーザー名のスペルを確認してください
2. git logで実際のユーザー名を確認してください:
   git log --all --format='%an' | sort -u
3. 部分一致で検索してみてください
```

## 日時変換仕様

### タイムゾーン変換
- **入力**: UTCまたはローカルタイムのGitコミット日時
- **出力**: 日本標準時（JST, UTC+9）
- **フォーマット**: `YYYY-MM-DD HH:MM:SS JST`

### 並び替えルール
1. **第一基準**: コミット日時（降順 = 新しい順）
2. **第二基準**: 同一日時の場合はコミットハッシュ順

## 出力ファイル保存先

### デフォルト保存先
```
[実行ディレクトリ]/git-history-[ユーザー名]-[YYYYMMDD].md
```

### カスタム保存先指定例
```
出力ファイルパス: ~/Documents/git-reports/history.md
```

## 統計情報の計算

### 含まれる統計情報
1. **総コミット数**: 該当ユーザーのコミット総数
2. **期間**: 最古のコミット日時から最新のコミット日時までの日数
3. **平均コミット頻度**: 総コミット数 ÷ 期間（日数）
4. **最多コミット日**: 最も多くコミットした日（オプション）
5. **時間帯分布**: コミットが多い時間帯の分析（オプション）

## 注意事項

### 実行前の確認
- プロジェクトパスが正しいGitリポジトリであることを確認
- ユーザー名が正確であることを確認（大文字小文字を区別）
- 出力先ディレクトリに書き込み権限があることを確認

### パフォーマンス
- 大規模リポジトリ（数千件以上のコミット）の場合、処理に時間がかかる可能性があります
- 期間指定や件数制限を活用して処理を軽量化できます

### プライバシー
- メールアドレスが出力に含まれます
- 公開する場合は適切に編集してください

### Git設定との互換性
- `git config user.name` で設定されている名前と一致する必要があります
- 複数の名前で同一ユーザーがコミットしている場合は、それぞれ個別に検索が必要です

## 実装時の推奨事項

1. **対話的な入力**: 必須パラメータは順次質問形式で取得
2. **入力検証**: パスの存在確認、ユーザー名の妥当性チェック
3. **プログレス表示**: 処理中の進捗を表示して待ち時間を可視化
4. **エラーハンドリング**: わかりやすいエラーメッセージと対処方法の提示
5. **柔軟な出力**: ユーザーが出力先を選択できるようにする