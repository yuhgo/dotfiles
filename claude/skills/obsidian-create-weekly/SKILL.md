---
name: obsidian-create-weekly
description: 今週（または先週）の週報を作成（デイリーノートの集約 + AI要約）。ユーザーが「週報を作って」「今週のまとめを作成して」と言ったときに使用。
allowed-tools: mcp__obsidian-vault__read_file, mcp__obsidian-vault__write_file, mcp__obsidian-vault__create_directory, mcp__obsidian-vault__list_directory, mcp__obsidian-vault__get_file_info, mcp__obsidian-vault__read_multiple_files, mcp__google-calendar__get-current-time, mcp__google-calendar__list-calendars, mcp__google-calendar__list-events
---

# Create Weekly Report

今週（または先週）の週報を作成します（デイリーノートの集約 + AI要約）。

## 前提条件

- MCP `obsidian-vault` がファイル操作可能であること
- MCP `google-calendar` が認証済みであること（オプション）
- 対象週に最低1つのデイリーノートが存在すること

---

## 実行手順

### Step 1: 基本情報の準備

1. 現在の日付を取得
2. 対象週を決定:
   - **月〜木曜日の場合**: 先週（前の月曜日〜日曜日）を対象
   - **金〜日曜日の場合**: 今週（今週の月曜日〜日曜日）を対象
3. ISO週番号を計算（例: 2026-W01）
4. 週の開始日（月曜日）と終了日（日曜日）を算出
5. 出力ファイルパス: `02_Weekly/YYYY/YYYY-WXX.md`
   - YYYYは週の開始日（月曜日）を基準
6. **ファイルが既に存在する場合**: 「この週の週報は既に存在します: [パス]」と報告して終了

### Step 2: デイリーノートの収集

対象週の各日（月〜日）について:

1. ファイルパス `01_Daily/YYYY/MM/YYYY-MM-DD.md` を確認
2. **注意**: 週が月をまたぐ場合、両方の月のディレクトリをチェック
3. 存在するファイルをリストに追加
4. **デイリーノートが0件の場合**: 「対象週のデイリーノートが見つかりませんでした。最低1つのデイリーノートが必要です。」と報告して終了

### Step 3: コンテンツの抽出と分析

各デイリーノートから以下を抽出:

| セクション | 抽出対象 |
|-----------|---------|
| `## 今日やったこと` | 活動内容 |
| `## 学んだこと・気づき` | 学び |
| `## メモ・なぐり書き` | 自由記述 |
| `- [x]` パターン | 完了タスク |
| `- [ ]` パターン | 未完了タスク |
| `### カレンダー予定` | カレンダー情報 |

### Step 4: カレンダーデータの集約

google-calendar MCPを使用:

1. 対象週のイベントを取得（`list-events`）
   - 週の開始日（月曜日）0:00 から 終了日（日曜日）23:59 まで
2. 日付ごとにグループ化
3. 週の予定概要を生成:
   ```
   - 01/06 (月): イベント1, イベント2
   - 01/07 (火): イベント3
   - 01/08 (水): 予定なし
   ```

### Step 5: AI要約の生成

収集したデータから以下を生成:

1. **今週のサマリー**（3-5文）
   - 週の全体的なテーマ・焦点
   - 主な成果
   - 重要なマイルストーン

2. **重要な活動・意思決定**
   - カテゴリ別（仕事/個人/学習）に整理
   - 箇条書きで記載
   - 例:
     ```markdown
     ### 仕事
     - プロジェクトキックオフミーティング実施
     - コードレビュー体制の見直し

     ### 個人
     - Nothing Phone 3a購入
     ```

3. **学び・気づき**
   - デイリーノートの「学んだこと・気づき」セクションから統合
   - 重複を除去して整理
   - 箇条書きで記載

4. **未完了タスク**
   - 全デイリーノートの `- [ ]` パターンを収集
   - 重複を除去
   - 来週への引き継ぎ事項として整理

### Step 6: 週報ファイルの作成

1. 必要に応じてディレクトリ作成: `02_Weekly/YYYY/`
2. `Templates/weekly.md` を読み込み
3. プレースホルダを置換:

   | プレースホルダ | 内容 |
   |---------------|------|
   | `{{week_start_date}}` | 週の開始日（月曜日、YYYY-MM-DD） |
   | `{{week_end_date}}` | 週の終了日（日曜日、YYYY-MM-DD） |
   | `{{year}}` | 年（YYYY） |
   | `{{week_number}}` | ISO週番号（01-53） |
   | `{{daily_links}}` | デイリーノートへのwikilink（例: `[[2026-01-06]], [[2026-01-07]]`） |
   | `{{week_summary}}` | AI生成サマリー（3-5文） |
   | `{{important_activities}}` | 重要な活動・意思決定（カテゴリ別箇条書き） |
   | `{{learnings}}` | 学び・気づき（箇条書き） |
   | `{{incomplete_tasks}}` | 未完了タスク（箇条書き、`- [ ]` 形式） |
   | `{{calendar_summary}}` | カレンダー概要（日付別） |
   | `{{daily_count}}` | 参照したデイリーノート数 |
   | `{{completed_tasks_count}}` | 完了タスク数 |
   | `{{incomplete_tasks_count}}` | 未完了タスク数 |
   | `{{daily_notes_list}}` | デイリーノート一覧（リンクと要約） |

4. **デイリーノート一覧の挿入例**:
   ```markdown
   - [[2026-01-01]] - 元日の大掃除、Claude Code再加入
   - [[2026-01-02]] - Inkdrop日記要約コマンド作成、Nothing Phone購入
   - [[2026-01-03]] - create-dailyコマンド作成、Obsidian連携構築
   ```

5. ファイルを作成

### Step 7: 完了報告

以下の形式で報告:

```
週報を作成しました: 02_Weekly/YYYY/YYYY-WXX.md

📅 対象期間: YYYY-MM-DD ~ YYYY-MM-DD（月〜日）

📝 参照したデイリーノート: X件
  - YYYY-MM-DD.md
  - YYYY-MM-DD.md
  - ...

✅ 完了タスク: X件
⏳ 未完了タスク: X件

📊 主なトピック:
  - トピック1
  - トピック2
  - トピック3
```

---

## エラーハンドリング

| ケース | 対応 |
|--------|------|
| 週報が既に存在 | 「この週の週報は既に存在します: [パス]」と報告して終了 |
| デイリーノートが0件 | 「対象週のデイリーノートが見つかりませんでした」と報告して終了 |
| 週が月をまたぐ | 両月のディレクトリを確認 |
| 一部の日のノートがない | 存在するノートのみで続行、不足した日付を報告に含める |
| Google Calendar未接続 | カレンダーセクションを「カレンダー情報を取得できませんでした」として続行 |
| デイリーノートが空 | カウントに含めるがコンテンツ抽出はスキップ |

---

## オプション引数（将来拡張）

- `--week YYYY-WXX`: 特定の週を指定して生成
- `--force`: 既存ファイルを上書き
- `--no-calendar`: カレンダー連携をスキップ
