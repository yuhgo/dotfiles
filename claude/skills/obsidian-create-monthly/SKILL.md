---
name: obsidian-create-monthly
description: 今月（または先月）の月報を作成（週報・日報の集約 + AI要約）。ユーザーが「月報を作って」「今月のまとめを作成して」と言ったときに使用。
allowed-tools: mcp__obsidian-vault__read_file, mcp__obsidian-vault__write_file, mcp__obsidian-vault__create_directory, mcp__obsidian-vault__list_directory, mcp__obsidian-vault__get_file_info, mcp__obsidian-vault__read_multiple_files
---

# Create Monthly Report

今月（または先月）の月報を作成します（週報・日報の集約 + AI要約）。

## 前提条件

- MCP `obsidian-vault` がファイル操作可能であること
- 対象月に最低1つの週報または日報が存在すること

---

## 実行手順

### Step 1: 基本情報の準備

1. 現在の日付を取得
2. 対象月を決定:
   - **月の1日〜15日の場合**: 先月を対象
   - **月の16日〜末日の場合**: 今月を対象
3. 月の開始日（1日）と終了日（末日）を算出
4. 出力ファイルパス: `03_Monthly/YYYY/YYYY-MM.md`
5. **ファイルが既に存在する場合**: 「この月の月報は既に存在します: [パス]」と報告して終了

### Step 2: 週報の収集

対象月の週報を収集:

1. 対象月に含まれる週（月曜日が対象月内、または週の大部分が対象月内）の週報を検索
2. ファイルパス: `02_Weekly/YYYY/YYYY-WXX.md`
3. 存在するファイルをリストに追加

### Step 3: 日報の収集（週報がない場合の補完）

週報が不足している期間について:

1. 対象月の各日の日報を確認
2. ファイルパス: `01_Daily/YYYY/MM/YYYY-MM-DD.md`
3. 週報でカバーされていない日のノートを追加で収集

### Step 4: コンテンツの抽出と分析

#### 週報から抽出:

| セクション | 抽出対象 |
|-----------|---------|
| `## 今週のサマリー` | 週の概要 |
| `## 重要な活動・意思決定` | 活動内容 |
| `## 学び・気づき` | 学び |
| `## 未完了タスク` | 未完了タスク |

#### 日報から抽出（週報がない場合）:

| セクション | 抽出対象 |
|-----------|---------|
| `## 今日やったこと` | 活動内容 |
| `## 学んだこと・気づき` | 学び |
| `- [x]` パターン | 完了タスク |
| `- [ ]` パターン | 未完了タスク |

### Step 5: AI要約の生成

収集したデータから以下を生成:

1. **今月のサマリー**（5-7文）
   - 月の全体的なテーマ・焦点
   - 主な成果・マイルストーン
   - 重要な変化や進展

2. **重要な活動・成果**
   - カテゴリ別（仕事/個人/学習）に整理
   - 週報の活動を統合・整理
   - 箇条書きで記載

3. **学び・気づき**
   - 週報・日報の学びを統合
   - 重複を除去して整理
   - 月間で特に重要な学びを強調

4. **来月への引き継ぎ**
   - 月末時点の未完了タスクを収集
   - 重複を除去
   - 継続案件・次月への課題として整理

### Step 6: 月報ファイルの作成

1. 必要に応じてディレクトリ作成: `03_Monthly/YYYY/`
2. `Templates/monthly.md` を読み込み
3. プレースホルダを置換:

   | プレースホルダ | 内容 |
   |---------------|------|
   | `{{month_start_date}}` | 月の開始日（YYYY-MM-01） |
   | `{{month_end_date}}` | 月の終了日（YYYY-MM-DD） |
   | `{{year}}` | 年（YYYY） |
   | `{{month_number}}` | 月（01-12） |
   | `{{weekly_links}}` | 週報へのwikilink |
   | `{{month_summary}}` | AI生成サマリー |
   | `{{important_activities}}` | 重要な活動・成果 |
   | `{{learnings}}` | 学び・気づき |
   | `{{incomplete_tasks}}` | 来月への引き継ぎ |
   | `{{weekly_count}}` | 参照した週報数 |
   | `{{daily_count}}` | 参照した日報数 |
   | `{{completed_tasks_count}}` | 完了タスク数 |
   | `{{incomplete_tasks_count}}` | 未完了タスク数 |
   | `{{weekly_notes_list}}` | 週報一覧（リンクと要約） |

4. **週報一覧の挿入例**:
   ```markdown
   - [[2026-W01]] - 年始の準備、Claude Code環境構築
   - [[2026-W02]] - プロジェクトキックオフ、読書習慣の確立
   ```

5. ファイルを作成

### Step 7: 完了報告

以下の形式で報告:

```
月報を作成しました: 03_Monthly/YYYY/YYYY-MM.md

対象期間: YYYY-MM-01 ~ YYYY-MM-DD

参照した週報: X件
  - YYYY-WXX.md
  - YYYY-WXX.md
  - ...

参照した日報: X件

完了タスク: X件
未完了タスク: X件

主なトピック:
  - トピック1
  - トピック2
  - トピック3
```

---

## エラーハンドリング

| ケース | 対応 |
|--------|------|
| 月報が既に存在 | 「この月の月報は既に存在します: [パス]」と報告して終了 |
| 週報・日報が0件 | 「対象月のノートが見つかりませんでした」と報告して終了 |
| 一部の週報がない | 該当期間の日報で補完 |
| 週報も日報もない週 | その週をスキップし、不足を報告に含める |

---

## オプション引数（将来拡張）

- `--month YYYY-MM`: 特定の月を指定して生成
- `--force`: 既存ファイルを上書き
